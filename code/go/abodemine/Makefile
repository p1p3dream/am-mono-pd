ABODEMINE_API_CONFIG_PATH ?= $(CURDIR)/projects/api/conf/local-ci.yaml
ABODEMINE_CI_CONFIG_PATH ?= $(CURDIR)/projects/ci/conf/local-ci.yaml
ABODEMINE_DATAPIPE_CONFIG_PATH ?= $(CURDIR)/projects/datapipe/conf/local-ci.yaml
ABODEMINE_SAAS_CONFIG_PATH ?= $(CURDIR)/projects/saas/conf/local-ci.yaml

GO_TEST_COUNT ?= 1

all:;

ci:
	ABODEMINE_API_CONFIG_PATH=${ABODEMINE_API_CONFIG_PATH} \
	ABODEMINE_CI_CONFIG_PATH=${ABODEMINE_CI_CONFIG_PATH} \
	ABODEMINE_DATAPIPE_CONFIG_PATH=${ABODEMINE_DATAPIPE_CONFIG_PATH} \
	ABODEMINE_SAAS_CONFIG_PATH=${ABODEMINE_SAAS_CONFIG_PATH} \
	go test -count=$(GO_TEST_COUNT) $(GO_TEST_PARAMS) ./...

test/%:
	ABODEMINE_API_CONFIG_PATH=${ABODEMINE_API_CONFIG_PATH} \
	ABODEMINE_CI_CONFIG_PATH=${ABODEMINE_CI_CONFIG_PATH} \
	ABODEMINE_DATAPIPE_CONFIG_PATH=${ABODEMINE_DATAPIPE_CONFIG_PATH} \
	ABODEMINE_SAAS_CONFIG_PATH=${ABODEMINE_SAAS_CONFIG_PATH} \
	go test $* -count=$(GO_TEST_COUNT) $(GO_TEST_PARAMS) -run=$(RUN)
